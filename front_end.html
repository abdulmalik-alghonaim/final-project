<html>
<body>
	<h2>Welcome to EasyCab!</h2><p>Porto, Portugal</p>
	<!-- load google maps and taxi data -->
	<script src="http://maps.google.com/maps/api/js"></script>
	<button id="show-map">Show Map</button>
	<div id="map" style="width:1024px; height:768px"></div>
	<script src="jquery-3.3.1.js"></script>
	<!-- <script src="train3.json" ></script> -->
<script>
var data = [{"TIMESTAMP":"1372636858","POLYLINE":[[-8.618643,41.141412],[-8.618499,41.141376],[-8.620326,41.14251],[-8.622153,41.143815],[-8.623953,41.144373],[-8.62668,41.144778],[-8.627373,41.144697],[-8.630226,41.14521],[-8.632746,41.14692],[-8.631738,41.148225],[-8.629938,41.150385],[-8.62911,41.151213],[-8.629128,41.15124],[-8.628786,41.152203],[-8.628687,41.152374],[-8.628759,41.152518],[-8.630838,41.15268],[-8.632323,41.153022],[-8.631144,41.154489],[-8.630829,41.154507],[-8.630829,41.154516],[-8.630829,41.154498],[-8.630838,41.154489]]},
{"TIMESTAMP":"1372636951","POLYLINE":[[-8.612964,41.140359],[-8.613378,41.14035],[-8.614215,41.140278],[-8.614773,41.140368],[-8.615907,41.140449],[-8.616609,41.140602],[-8.618472,41.141412],[-8.620623,41.142789],[-8.622558,41.144094],[-8.62506,41.144805],[-8.627436,41.144733],[-8.630082,41.145174],[-8.6319,41.146461],[-8.632584,41.147316],[-8.631252,41.148774],[-8.629713,41.150628],[-8.628804,41.152077],[-8.628579,41.152464],[-8.62875,41.152662],[-8.630424,41.15277],[-8.632683,41.152779],[-8.635131,41.152563],[-8.637705,41.153013],[-8.64036,41.15358],[-8.642205,41.154021],[-8.644068,41.154507],[-8.646453,41.154336],[-8.648613,41.1543],[-8.649504,41.154336],[-8.649837,41.154354],[-8.649837,41.1543],[-8.649882,41.154282],[-8.649936,41.1543],[-8.6499,41.154264],[-8.599383,41.141736],[-8.59653,41.140566],[-8.65008,41.154291],[-8.650395,41.153814],[-8.650377,41.153832],[-8.650359,41.153787],[-8.649891,41.153166],[-8.649369,41.152572],[-8.649198,41.152374],[-8.649711,41.151213],[-8.649117,41.150466],[-8.649117,41.149062],[-8.648613,41.148261],[-8.648424,41.148225],[-8.647587,41.148405],[-8.64594,41.148414],[-8.643861,41.148135],[-8.642763,41.148027],[-8.640918,41.14836],[-8.637759,41.148351],[-8.635338,41.147964],[-8.633277,41.147172],[-8.631513,41.146146],[-8.629776,41.14503],[-8.627814,41.144643],[-8.625996,41.144769],[-8.624088,41.144463],[-8.621325,41.143401],[-8.619444,41.141961],[-8.617365,41.140863],[-8.61597,41.14053]]},
{"TIMESTAMP":"1372636854","POLYLINE":[[-8.574678,41.151951],[-8.574705,41.151942],[-8.574696,41.151933],[-8.57466,41.15196],[-8.574723,41.151933],[-8.574714,41.151924],[-8.574714,41.151924],[-8.575164,41.150934],[-8.577135,41.150232],[-8.57853,41.148639],[-8.579745,41.147316],[-8.579358,41.146173],[-8.580744,41.14503],[-8.582904,41.14512],[-8.58438,41.146479],[-8.610849,41.145876],[-8.610012,41.146479],[-8.609058,41.146866],[-8.608968,41.147055],[-8.586027,41.148702],[-8.587197,41.149224],[-8.588205,41.148963],[-8.588835,41.147604],[-8.590176,41.147082],[-8.592543,41.146614],[-8.594721,41.146245],[-8.596737,41.146317],[-8.59869,41.146119],[-8.598816,41.146101],[-8.600193,41.146155],[-8.601057,41.146101],[-8.602344,41.14575],[-8.602785,41.145705],[-8.60328,41.145597],[-8.604045,41.145417],[-8.604657,41.144256],[-8.605854,41.142555],[-8.607951,41.142753],[-8.607978,41.142825],[-8.607996,41.142879],[-8.607987,41.142888],[-8.608005,41.142915],[-8.607996,41.142915]]},
{"TIMESTAMP":"1372637303","POLYLINE":[[-8.639847,41.159826],[-8.640351,41.159871],[-8.642196,41.160114],[-8.644455,41.160492],[-8.646921,41.160951],[-8.649999,41.161491],[-8.653167,41.162031],[-8.656434,41.16258],[-8.660178,41.163192],[-8.663112,41.163687],[-8.666235,41.1642],[-8.669169,41.164704],[-8.670852,41.165136],[-8.670942,41.166576],[-8.66961,41.167962],[-8.668098,41.168988],[-8.66664,41.170005],[-8.665767,41.170635],[-8.66574,41.170671]]},
{"TIMESTAMP":"1372636965","POLYLINE":[[-8.615502,41.140674],[-8.614854,41.140926],[-8.613351,41.14152],[-8.609976,41.140854],[-8.607537,41.141295],[-8.603676,41.141808],[-8.599833,41.141916],[-8.596458,41.140494],[-8.592993,41.140008],[-8.589384,41.140674],[-8.587026,41.142753],[-8.583831,41.143644],[-8.581086,41.143698],[-8.579133,41.144238],[-8.577594,41.144688],[-8.578809,41.145957],[-8.580168,41.147136],[-8.578827,41.149359],[-8.579808,41.151879],[-8.581626,41.153868],[-8.582076,41.155434],[-8.580546,41.155947],[-8.578719,41.156271],[-8.578629,41.157693],[-8.578521,41.159439],[-8.578224,41.160717]]},
{"TIMESTAMP":"1372637091","POLYLINE":[[-8.645994,41.18049],[-8.645949,41.180517],[-8.646048,41.180049],[-8.646804,41.178888],[-8.649495,41.178465],[-8.65215,41.177961],[-8.654049,41.177196],[-8.655012,41.177925],[-8.656353,41.177853],[-8.659647,41.177277],[-8.662518,41.177619],[-8.664561,41.179221],[-8.667432,41.178537],[-8.668944,41.176674],[-8.671374,41.17518],[-8.673894,41.173308],[-8.676918,41.171841],[-8.680032,41.171949],[-8.682615,41.173191],[-8.685441,41.173776],[-8.688105,41.17365],[-8.688879,41.174379],[-8.689059,41.17608],[-8.689086,41.176431],[-8.689059,41.176593],[-8.687502,41.176755],[-8.687259,41.177781],[-8.687259,41.178078],[-8.687268,41.178087]]},
{"TIMESTAMP":"1372637299","POLYLINE":[[-8.617563,41.146182],[-8.617527,41.145849],[-8.616978,41.144832],[-8.615754,41.145426],[-8.615745,41.145408],[-8.615466,41.145714],[-8.615142,41.147046],[-8.615142,41.147118],[-8.61579,41.147298],[-8.617455,41.147235],[-8.617716,41.147217],[-8.618013,41.147505],[-8.618796,41.148603],[-8.619948,41.148468],[-8.620758,41.148927],[-8.621055,41.150565],[-8.620893,41.152284],[-8.621001,41.154246],[-8.620821,41.15547],[-8.620848,41.155452],[-8.620812,41.155803],[-8.62092,41.157225],[-8.622819,41.158242],[-8.624682,41.159475],[-8.624664,41.159718],[-8.624691,41.160492],[-8.624709,41.161563],[-8.624718,41.161563],[-8.624727,41.161554],[-8.624736,41.161545],[-8.624736,41.161536],[-8.624736,41.161536],[-8.624727,41.161545],[-8.6247,41.161554]]},
{"TIMESTAMP":"1372637274","POLYLINE":[[-8.611794,41.140557],[-8.611785,41.140575],[-8.612001,41.140566],[-8.612622,41.140503],[-8.613702,41.140341],[-8.614665,41.140386],[-8.615844,41.140485],[-8.61561,41.140683],[-8.614566,41.141088],[-8.614395,41.141979],[-8.613936,41.142942],[-8.612793,41.143851],[-8.611488,41.144787],[-8.610543,41.144391],[-8.610282,41.143536],[-8.610255,41.143401],[-8.608824,41.143239],[-8.608419,41.143149],[-8.606565,41.142348],[-8.605179,41.143446],[-8.604549,41.144796],[-8.604297,41.1453],[-8.603505,41.145561],[-8.602488,41.145633],[-8.601039,41.145759],[-8.600436,41.146443],[-8.599977,41.147289],[-8.598681,41.14827],[-8.598303,41.148423],[-8.598618,41.149467],[-8.597529,41.151294],[-8.596161,41.153679],[-8.594838,41.155983],[-8.594163,41.157135],[-8.593002,41.159187],[-8.591454,41.161608],[-8.589924,41.163453],[-8.589402,41.163309]]},
{"TIMESTAMP":"1372637210","POLYLINE":[[-8.57952,41.145948],[-8.580942,41.145039],[-8.582706,41.145021],[-8.584092,41.146164],[-8.58546,41.14683],[-8.587116,41.147397],[-8.586171,41.148018],[-8.58609,41.148963],[-8.588016,41.149368],[-8.590401,41.150016],[-8.593119,41.150736],[-8.593506,41.150853],[-8.593668,41.15097],[-8.595342,41.150232],[-8.59608,41.149827],[-8.597466,41.148909],[-8.598051,41.148567],[-8.598663,41.148342],[-8.600688,41.148585],[-8.601723,41.147325],[-8.601795,41.147262],[-8.601768,41.147289],[-8.602227,41.147001],[-8.603667,41.146578],[-8.603739,41.146578],[-8.604477,41.146164],[-8.604702,41.145408],[-8.604477,41.145327],[-8.604747,41.144445],[-8.604945,41.144148],[-8.603703,41.143608],[-8.602236,41.142807],[-8.603244,41.142681],[-8.604,41.142798],[-8.603982,41.142798],[-8.603973,41.142816]]},
{"TIMESTAMP":"1372636875","POLYLINE":[[-8.619894,41.148009],[-8.620164,41.14773],[-8.62065,41.148513],[-8.62092,41.150313],[-8.621208,41.151951],[-8.621118,41.153517],[-8.620884,41.155416],[-8.620938,41.155479],[-8.620974,41.155461],[-8.621028,41.155461],[-8.619777,41.155344],[-8.619282,41.155335],[-8.618112,41.155101],[-8.61534,41.154579],[-8.613297,41.153994],[-8.612064,41.153832],[-8.611911,41.155227],[-8.611794,41.156838],[-8.610804,41.157171],[-8.61021,41.15727],[-8.609508,41.157333],[-8.60949,41.157351]]},
{"TIMESTAMP":"1372637984","POLYLINE":[[-8.56242,41.168403],[-8.562429,41.168358],[-8.562348,41.167953],[-8.564571,41.167125],[-8.566596,41.166621],[-8.568,41.167476],[-8.570295,41.167755],[-8.570223,41.169321],[-8.570898,41.168817],[-8.572626,41.16924],[-8.57403,41.168457],[-8.576046,41.167197],[-8.577711,41.165442],[-8.580087,41.164065],[-8.58222,41.164452],[-8.584056,41.163201],[-8.586387,41.163381],[-8.588772,41.1642],[-8.589546,41.164164],[-8.590158,41.163444],[-8.591607,41.16186],[-8.593272,41.160564],[-8.595792,41.160744],[-8.596701,41.160942],[-8.597898,41.161158],[-8.598528,41.161221],[-8.600886,41.161527],[-8.603532,41.161788],[-8.603955,41.161815],[-8.60571,41.162031],[-8.60787,41.162292],[-8.61003,41.16258],[-8.612199,41.162823],[-8.614602,41.163165],[-8.617104,41.163498],[-8.619219,41.163759],[-8.620488,41.163894],[-8.62047,41.163903],[-8.620452,41.163912],[-8.620452,41.163921],[-8.621523,41.164038],[-8.623044,41.164182],[-8.623026,41.1642],[-8.623017,41.164218]]},
{"TIMESTAMP":"1372637905","POLYLINE":[[-8.615907,41.140557],[-8.614449,41.141088],[-8.613522,41.14143],[-8.609904,41.140827],[-8.609301,41.139522],[-8.609544,41.138865],[-8.610777,41.137551],[-8.611452,41.136012],[-8.610624,41.134563],[-8.609319,41.134446],[-8.608014,41.1345],[-8.607987,41.134536],[-8.607987,41.134518],[-8.607861,41.134536],[-8.60778,41.134545],[-8.607411,41.134527],[-8.605476,41.134392],[-8.604603,41.134176],[-8.604594,41.134158]]},
{"TIMESTAMP":"1372637343","POLYLINE":[[-8.618868,41.155101],[-8.6175,41.154912],[-8.615079,41.154525],[-8.613468,41.154228],[-8.613261,41.154102],[-8.613297,41.153832],[-8.612037,41.153904],[-8.611929,41.155803],[-8.610876,41.157171],[-8.610183,41.157252],[-8.610138,41.15727],[-8.609508,41.157369],[-8.608707,41.158395],[-8.607915,41.160042],[-8.607654,41.1606],[-8.606295,41.164155],[-8.60643,41.166693],[-8.60634,41.169123],[-8.60445,41.171112],[-8.60121,41.171166],[-8.597205,41.171625],[-8.593578,41.170968],[-8.5905,41.168979],[-8.587206,41.167062],[-8.583624,41.166252],[-8.58213,41.1642],[-8.58114,41.163381],[-8.579376,41.164326],[-8.577468,41.165316],[-8.576298,41.163858],[-8.575101,41.16231],[-8.575065,41.162265]]},
{"TIMESTAMP":"1372638595","POLYLINE":[[-8.608716,41.153499],[-8.607627,41.153481],[-8.606502,41.153472],[-8.606493,41.153472],[-8.605269,41.153427],[-8.604756,41.154156],[-8.604648,41.155623],[-8.604477,41.157351],[-8.604279,41.159016],[-8.604351,41.16015],[-8.604387,41.160276],[-8.603892,41.161545],[-8.60562,41.162085],[-8.607987,41.162391],[-8.6103,41.162661],[-8.610957,41.162751],[-8.610957,41.162805],[-8.611965,41.162841],[-8.614242,41.163129],[-8.616573,41.16339],[-8.61894,41.163705],[-8.621082,41.163993],[-8.623305,41.164281],[-8.624889,41.164722],[-8.625042,41.166513],[-8.626068,41.166972],[-8.626554,41.166945],[-8.628309,41.16744],[-8.630352,41.168079],[-8.631639,41.16798],[-8.631981,41.168484],[-8.632206,41.16843],[-8.63271,41.168304],[-8.632737,41.168295]]},
{"TIMESTAMP":"1372637610","POLYLINE":[[-8.585145,41.164857],[-8.584146,41.164704],[-8.583147,41.164758],[-8.627931,41.157954],[-8.628813,41.159106],[-8.628264,41.160978],[-8.627589,41.163057],[-8.627508,41.1633],[-8.627517,41.1633],[-8.627184,41.164407],[-8.628759,41.164947],[-8.63127,41.164893],[-8.633736,41.163759],[-8.63613,41.164254],[-8.63613,41.164272],[-8.638209,41.16474],[-8.640144,41.165658],[-8.642079,41.16726],[-8.643915,41.168907],[-8.606169,41.172093],[-8.610615,41.174352],[-8.642412,41.170365],[-8.643042,41.17041],[-8.644041,41.169546],[-8.645868,41.169042],[-8.647686,41.170482],[-8.649207,41.169879],[-8.648784,41.16924],[-8.648064,41.169384],[-8.647992,41.16942],[-8.647992,41.169402],[-8.647983,41.169393],[-8.647974,41.169393],[-8.647983,41.169393],[-8.647983,41.169393],[-8.647983,41.169393],[-8.647983,41.169393],[-8.647974,41.169393],[-8.647974,41.169402],[-8.647983,41.169411],[-8.647983,41.169411],[-8.647983,41.169411],[-8.647983,41.169411],[-8.647974,41.16942],[-8.647965,41.169429],[-8.647965,41.169402],[-8.648019,41.169537],[-8.64918,41.169555],[-8.648199,41.170509],[-8.646732,41.169708],[-8.645418,41.169519],[-8.643618,41.168286],[-8.641152,41.166306],[-8.638866,41.164695],[-8.636139,41.164209],[-8.633286,41.162976],[-8.632593,41.162049],[-8.631009,41.160069],[-8.630145,41.15826],[-8.629299,41.156955],[-8.628138,41.157261],[-8.628138,41.157405],[-8.628165,41.157522],[-8.628147,41.157522]]}];

var map;
var markers = [];
var max_length=0;
var locations =[];

function getTaxiLocations(){
	var points=[];
	for (i=0;i<10;i++){
		index = Math.floor(Math.random()*data.length);
		selection = data[index];
		points.push(selection);
	}
	return points;
}

function getMarker(index){
	var marker = markers.find(function(taxi){
		return taxi.title === index;
	});
	return marker;
}
function moveMarker(taxi,index,counter) {
    var newLatlng = new google.maps.LatLng(taxi.POLYLINE[counter][1],taxi.POLYLINE[counter][0]);
    getMarker(index).setPosition(newLatlng);
};

function addMarker(taxi){
	var marker = new google.maps.Marker({
	  	position: new google.maps.LatLng(taxi.POLYLINE[0][1],taxi.POLYLINE[0][0]),
	    icon: { 
	        path:google.maps.SymbolPath.CIRCLE,
	        fillColor: 'rgba(' +  Math.floor(Math.random()*255) + ', ' +
							Math.floor(Math.random()*255) + ', ' +
							Math.floor(Math.random()*255) + ',  1)',
	        fillOpacity: 1,
	        scale:10,
	        strokeWeight:1
	    },
		map: map,
		title: index
	});
	markers.push(marker);
};
function addMarkers(locations){
	for(var counter=0; counter <= max_length;counter++){
//     Use forEach to loop through taxis.
//     If taxi exists, move marker.
//	   If taxi does not exist, add marker.
		locations.forEach((taxi,index)=>{
    	//var marker = getMarker(taxi.id);
    		if(counter === 0){
        		addMarker(taxi,index);
    		}
    		else{
				if (counter<taxi.POLYLINE.length){
        		moveMarker(taxi,index,counter);}
				else{
					getMarker(index).icon.fillColor = 'ragba(0,0,0,1)'
					}
    		}
		})
		setTimeout(addMarkers,1); //loops and calls the code again every 0.1 second
	}
	map = 0;
};


function initialize(){
	//Add the event listener after Google Maps and window is loaded
    $('#show-map').click(function () {
        var latlng = new google.maps.LatLng(41.162142, -8.621953); //coordinates of the center of Porto, Portugal
		var myOptions = {
		zoom : 14,
		center : latlng,
		mapTypeId : google.maps.MapTypeId.ROADMAP
	};
	map = new google.maps.Map(document.getElementById('map'), myOptions);
	// Adds markers to the map and into array
	locations = getTaxiLocations();
	locations.forEach((point)=>{
		if (point.POLYLINE.length>max_length){max_length=point.POLYLINE.length}
	});
	addMarkers(locations);
})};

google.maps.event.addDomListener(window, 'load', initialize);
//window.onload = initialize;

</script>
</body>
</html>
