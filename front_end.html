<html>
<body>
	<h2>EasyCab: Porto, Portugal</h2>
	<!-- load google maps and taxi data -->
	<script src="http://maps.google.com/maps/api/js"></script>
	<button id="Start Taxi Trajectories">Show Map</button>
	<div id="map" style="width:1024px; height:768px"></div>
	<script src="train3.json" ></script>
<script>

var map;
var markers = [];
var points=[];
var max_length=0;

function getTaxiLocations(){
	for (i=0;i<10;i++){
		index = Math.floor(Math.random()*data.length());
		selection = data[index];
		points.push(selection);
	}
	return points;
}


function initialize(){
	//Add the event listener after Google Mpas and window is loaded
    $('#show-map').click(function () {
        var latlng = new google.maps.LatLng(41.162142, -8.621953); //coordinates of the center of Porto, Portugal
		var myOptions = {
		zoom : 16,
		center : latlng,
		mapTypeId : google.maps.MapTypeId.ROADMAP
	};
	map = new google.maps.Map(document.getElementById('map'), myOptions);
	addMarkers();
	
    });
}
google.maps.event.addDomListener(window, 'load', initialize);



// Adds markers to the map and into array
var locations = getTaxiLocations();
locations.forEach((point)=>{
	if (point.POLYLINE.length>max_length){max_length=point.POLYLINE.length}
});
function addMarkers(){
	var counter = 0
	if (counter<= max_length){
		counter++;
//     Use forEach to loop through taxis.
//     If taxi exists, move marker.
//     If taxi does not exist, add marker.
		locations.forEach(function(taxi,index){
    	//var marker = getMarker(taxi.id);
    	if(counter === 0){
        	addMarker(taxi,index);
    	}
    	else{
			if (counter<taxi.POLYLINE.length){
        	moveMarker(taxi,index);}
			else{
				markers[index].icon.fillColor = 'ragba(0,0,0,1)'
			}
    	}
})

console.log(new Date());
setTimeout(addMarkers,100); //loops and calls the code again every 0.1 second
}};
function addMarker(taxi){
	var marker = new google.maps.Marker({
	  	position: new google.maps.LatLng(taxi.POLYLINE[0][1],taxi.POLYLINE[0][0]),
	    icon: { 
	        path:google.maps.SymbolPath.CIRCLE,
	        fillColor: 'rgba(' +  Math.floor(Math.random()*255) + ', ' +
							Math.floor(Math.random()*255) + ', ' +
							Math.floor(Math.random()*255) + ',  1)',
	        fillOpacity: 1,
	        scale:7,
	        strokeWeight:1
	    },
		map: map,
		title: index
	});
	markers.push(marker);
};

function moveMarker(taxi,index) {
    var newLatlng = new google.maps.LatLng(taxi.POLYLINE[counter][1],taxi.POLYLINE[counter][0]);
    markers[index].setPosition(newLatlng);
};

// function getMarker(id){


// points.forEach(function(val){
// 	val.POLYLINE.forEach(()=>{

// 	});
// })
// 	//points.POLYLINE.
// 	var marker = markers.find(function(item){
// 		return item.title === id;
// 	});
// 	return marker;
// };

//window.onload = init;

</script>

</html>
